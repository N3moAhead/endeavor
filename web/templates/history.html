<!doctype html>
<html lang="en" class="dark">
    <head>
        <title>Endeavor - History</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="/static/css/style.css" rel="stylesheet" />
    </head>
    <body class="bg-gray-900 text-gray-200 antialiased">
        <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-12">
            <header class="text-center mb-10">
                <div class="nav-section mb-8">
                    <a
                        href="/"
                        class="text-lg font-semibold text-gray-300 hover:bg-gray-700 py-3 px-5 rounded-lg mx-2 transition-colors"
                        >üìù Daily Entry</a
                    >
                    <a
                        href="/history"
                        class="text-lg font-semibold text-white bg-gray-800 py-3 px-5 rounded-lg mx-2 border-2 border-indigo-500 shadow-[0_0_15px_rgba(79,70,229,0.8)]"
                        >üìä History</a
                    >
                </div>
                <h1 class="text-4xl font-bold text-white">History</h1>
            </header>

            {{if .Days}}
            <div
                class="bg-gray-800 border border-gray-700 rounded-lg p-4 sm:p-6"
            >
                <div
                    class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4"
                >
                    <div class="year-filter">
                        <label for="year-select" class="mr-2 text-gray-300"
                            >Filter by year:</label
                        >
                        <select
                            id="year-select"
                            onchange="filterByYear()"
                            class="bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        >
                            <option value="">All</option>
                            {{range .Years}}
                            <option value="{{.}}">{{.}}</option>
                            {{end}}
                        </select>
                    </div>
                    <div
                        class="flex flex-wrap justify-center items-center gap-x-4 gap-y-1 text-xs text-gray-400"
                    >
                        <div class="flex items-center gap-1">
                            <div class="w-3 h-3 rounded-sm bg-red-700"></div>
                            <span>Bad</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div
                                class="w-3 h-3 rounded-sm bg-orange-500"
                            ></div>
                            <span>Meh</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div
                                class="w-3 h-3 rounded-sm bg-yellow-500"
                            ></div>
                            <span>Okay</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div class="w-3 h-3 rounded-sm bg-green-400"></div>
                            <span>Good</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div class="w-3 h-3 rounded-sm bg-green-600"></div>
                            <span>Amazing</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div class="w-3 h-3 rounded-sm bg-gray-700"></div>
                            <span>None</span>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto pb-2">
                    <div
                        id="history-grid"
                        class="history-grid grid grid-flow-col grid-rows-7 gap-1.5"
                    >
                        {{range .Days}}
                        <a
                            href="/day/detail?id={{.ID}}"
                            class="day-tile w-6 h-6 rounded-sm transition-colors {{if not .Mood}}bg-gray-700 hover:bg-gray-600{{end}}{{if .Mood}}{{if eq .Mood.Name "bad"}}bg-red-700 hover:bg-red-600{{else if eq .Mood.Name "meh"}}bg-orange-500 hover:bg-orange-400{{else if eq .Mood.Name "okay"}}bg-yellow-500 hover:bg-yellow-400{{else if eq .Mood.Name "good"}}bg-green-400 hover:bg-green-300{{else if eq .Mood.Name "amazing"}}bg-green-600 hover:bg-green-500{{else}}bg-gray-700 hover:bg-gray-600{{end}}{{end}}"
                            title="{{.Date.Format "Jan 2, 2006"}} - Mood: {{if .Mood}}{{.Mood.Name}}{{else}}N/A{{end}}"
                            data-year="{{.Date.Year}}"
                        >
                            <span class="sr-only"
                                >Details for {{.Date.Format "Jan 2, 2006"}}</span
                            >
                        </a>
                        {{end}}
                    </div>
                </div>
            </div>
            {{else}}
            <div
                class="text-center py-16 bg-gray-800 rounded-lg border border-gray-700"
            >
                <h2 class="text-2xl font-bold mb-2">No entries yet</h2>
                <p class="text-gray-400">
                    Start your journey today by adding a daily entry!
                </p>
            </div>
            {{end}}
        </div>

        <script>
            function filterByYear() {
                const selectedYear =
                    document.getElementById("year-select").value;
                const tiles = document.querySelectorAll(".day-tile");

                tiles.forEach((tile) => {
                    if (
                        selectedYear === "" ||
                        tile.dataset.year === selectedYear
                    ) {
                        tile.classList.remove("hidden");
                    } else {
                        tile.classList.add("hidden");
                    }
                });
            }
            // Ensure all tiles are visible on first load if a filter is pre-selected or on back navigation
            filterByYear();
        </script>
    </body>
</html>
